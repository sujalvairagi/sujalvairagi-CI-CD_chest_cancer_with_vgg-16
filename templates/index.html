<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chest Cancer Classification</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">

  <style>
    body{
      background:#111;
      color:#fff;
      font-family:Arial, Helvetica, sans-serif;
    }
    .main-container{
      margin-top:30px;
    }
    .title{
      text-align:center;
      font-size:38px;
      font-weight:bold;
      margin-bottom:25px;
      color:#a9d2ff;
    }
    .img-part{
      background:#222;
      padding:20px;
      border-radius:6px;
      text-align:center;
      border:1px solid #333;
    }
    .image-preview{
      width:100%;
      max-width:420px;
      border:2px solid #2b4db8;
      border-radius:4px;
    }
    .btn-part{
      margin-top:15px;
      display:flex;
      justify-content:center;
      gap:20px;
    }
    .res-part{
      background:#1b1b1b;
      border:1px solid #333;
      padding:20px;
      border-radius:6px;
      min-height:250px;
      font-size:16px;
    }
    .res-title{
      text-align:center;
      font-size:26px;
      margin-bottom:15px;
    }
    .badge-label{
      font-size:18px;
      padding:8px 14px;
    }
  </style>
</head>

<body>
<div class="container main-container">
  <div class="title">Chest Cancer Classification</div>

  <div class="row">
    <!-- LEFT SIDE -->
    <div class="col-md-6">
      <div class="img-part">
        <img id="photo" class="image-preview" src="https://i.imgur.com/3QFQW5R.png" alt="Preview">

        <div class="btn-part">
          <input type="file" id="fileinput" accept="image/*" class="btn btn-primary">
          <button type="button" class="btn btn-success" id="predictBtn">Predict</button>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE -->
    <div class="col-md-6">
      <div class="res-part">
        <div class="res-title">Prediction Results</div>
        <div id="resultBox">
          Upload an image and click <b>Predict</b>.
        </div>
      </div>
    </div>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>
  let base64Image = "";

  // Preview uploaded image
  $("#fileinput").change(function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const dataURL = e.target.result;
      $("#photo").attr("src", dataURL);

      // remove "data:image/...;base64," prefix
      base64Image = dataURL.split(",")[1];
    };
    reader.readAsDataURL(file);
  });

  // Predict button click
  $("#predictBtn").click(function () {
    if (!base64Image) {
      $("#resultBox").html("<span class='text-warning'>⚠️ Please upload an image first.</span>");
      return;
    }

    $("#resultBox").html("<span class='text-info'>⏳ Predicting...</span>");

    const payload = JSON.stringify({ image: base64Image });

    $.ajax({
      url: "/predict",
      type: "POST",
      contentType: "application/json",
      data: payload,
      success: function (res) {
        // ✅ res is a JSON object {label, confidence}

        const label = res.label || "unknown";
        const conf = (res.confidence !== undefined) ? (res.confidence * 100).toFixed(2) : "N/A";

        let badgeClass = "badge-secondary";
        if (label === "cancer") badgeClass = "badge-danger";
        if (label === "normal") badgeClass = "badge-success";
        if (label === "uncertain") badgeClass = "badge-warning";
        if (label === "not_ct_scan") badgeClass = "badge-info";

        $("#resultBox").html(`
          <div style="margin-top:10px;">
            <div><b>Label:</b> <span class="badge ${badgeClass} badge-label">${label}</span></div>
            <div style="margin-top:10px;"><b>Confidence:</b> ${conf}%</div>
            <hr style="border-color:#333;">
            <pre style="color:#ddd;">${JSON.stringify(res, null, 2)}</pre>
          </div>
        `);
      },
      error: function (err) {
        $("#resultBox").html("<span class='text-danger'>❌ Prediction failed. Check server logs.</span>");
        console.log(err);
      }
    });
  });
</script>

</body>
</html>
